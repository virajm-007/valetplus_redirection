<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Opening ValetPlus...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Prevent caching -->
  <meta http-equiv="cache-control" content="no-cache" />
  <meta http-equiv="pragma" content="no-cache" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background: #ffffff;
      margin: 0;
    }
    .loader {
      text-align: center;
      font-size: 16px;
      color: #333;
    }
  </style>
</head>

<body>
  <div class="loader">
    Redirecting to ValetPlusâ€¦
  </div>

  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);

      // Example: ?valetId=VAL12345&plate=MH12AB1234
      const valetId = params.get("valetId") || "";
      const plate = params.get("plate") || "";

      const message =
        `Hello ValetPlus ðŸ‘‹\n` +
        `My valet has been created.\n\n` +
        `ðŸš— Vehicle No: ${plate}\n` +
        `ðŸŽ« Valet ID: ${valetId}`;

      const encodedMessage = encodeURIComponent(message);

      const valetAppDeepLink = `valetplus://open?valetId=${valetId}`;
      const valetUniversalLink = `https://app.valetplus.net/open?valetId=${valetId}`;
      const whatsappLink = `https://wa.me/918180091425?text=${encodedMessage}`;
      const fallbackSite = `https://valetplus.net`;

      const userAgent = navigator.userAgent || navigator.vendor;

      const isIOS = /iPhone|iPad|iPod/i.test(userAgent);
      const isAndroid = /Android/i.test(userAgent);

      let appOpened = false;

      // Fallback logic
      const fallbackToWhatsApp = () => {
        window.location.href = whatsappLink;

        // Final fallback to website
        setTimeout(() => {
          window.location.href = fallbackSite;
        }, 2500);
      };

      // Try ValetPlus App
      if (isIOS) {
        // iOS prefers Universal Links
        window.location.href = valetUniversalLink;

        setTimeout(() => {
          fallbackToWhatsApp();
        }, 2000);
      } else if (isAndroid) {
        // Android prefers deep links
        window.location.href = valetAppDeepLink;

        setTimeout(() => {
          fallbackToWhatsApp();
        }, 2000);
      } else {
        // Desktop or unknown
        window.location.href = fallbackSite;
      }
    })();
  </script>
</body>
</html>
